(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3279:function(e,t,a){Promise.resolve().then(a.bind(a,4785))},4785:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var n=a(3827),r=a(4090),o=a(1231);class c{async getDb(){return this.db?this.db:new Promise((e,t)=>{let a=indexedDB.open(this.dbName,this.version);a.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains("images")){let e=t.createObjectStore("images",{keyPath:"id"});e.createIndex("name","name",{unique:!1}),e.createIndex("category","category",{unique:!1})}},a.onerror=e=>{console.error("Error opening database:",e.target.error),t(e.target.error)},a.onsuccess=t=>{this.db=t.target.result,e(this.db)}})}generateUUID(){return(0,o.Z)()}async fetchItemCount(e){let t=await this.getDb();return new Promise((a,n)=>{let r=t.transaction(["images"],"readonly").objectStore("images").index("category").count(e);r.onsuccess=()=>a(r.result),r.onerror=e=>n(e.target.error)})}async saveImage(e,t,a){let n=await this.getDb();return new Promise((r,o)=>{let c=n.transaction(["images"],"readwrite").objectStore("images"),s=this.generateUUID(),l=c.put({id:s,name:t,category:a,data:e});l.onsuccess=()=>r(s),l.onerror=e=>o(e.target.error)})}async removeImage(e){let t=await this.getDb();return new Promise((a,n)=>{let r=t.transaction(["images"],"readwrite").objectStore("images").delete(e);r.onsuccess=()=>a(!0),r.onerror=e=>n(e.target.error)})}async fetchImageById(e){let t=await this.getDb();return new Promise((a,n)=>{let r=t.transaction(["images"],"readonly").objectStore("images").get(e);r.onsuccess=()=>{r.result?a(r.result):n(Error("Image not found"))},r.onerror=e=>n(e.target.error)})}async fetchImageUUIDsByCategory(e){let t=await this.getDb();return new Promise((a,n)=>{let r=t.transaction(["images"],"readonly").objectStore("images").index("category").getAllKeys(e);r.onsuccess=()=>{a(r.result)},r.onerror=e=>n(e.target.error)})}async fetchImagesByCategory(e){let t=await this.getDb();return new Promise((a,n)=>{let r=t.transaction(["images"],"readonly").objectStore("images").index("category").getAll(e);r.onsuccess=()=>a(r.result),r.onerror=e=>n(e.target.error)})}constructor(e,t){this.dbName=e,this.version=t,this.db=null}}var s=a(3486);function l(){var e;let[t,a]=(0,r.useState)([{id:"placeholder_0",type:"placeholder"}]),[o,l]=(0,r.useState)(!1),[i,d]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!1),[h,u]=(0,r.useState)("Start"),[p,f]=(0,r.useState)(""),[y,x]=(0,r.useState)(null),[w,j]=(0,r.useState)(!1),[b,v]=(0,r.useState)(""),[N,I]=(0,r.useState)(!1),[k,S]=(0,r.useState)(!1),[C,D]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{let e=new c("imageDB",5);await e.getDb(),console.log("db helper ",e),x(e)})()},[]),(0,r.useEffect)(()=>{B()},[p]),(0,r.useEffect)(()=>{let e=window.location.protocol,t=window.location.hostname,a=window.location.port;f("".concat(e,"//").concat(t).concat(a?":".concat(a):""))},[]);let U=async()=>{if(void 0!==window.ethereum)try{let[e]=await window.ethereum.request({method:"eth_requestAccounts"});v(e)}catch(e){console.error("User denied account access")}else console.log("MetaMask is not installed!")},F=async()=>{try{void 0!==window.ethereum&&await window.ethereum.request({method:"eth_requestAccounts",params:[[]]})}catch(e){console.error("Error disconnecting wallet:",e)}v(""),j(!1)},P=async()=>{if(!b){console.error("No account connected");return}I(!0);let e="Welcome to your appliance! Sign this message to log in. This request will not trigger a blockchain transaction or cost any gas fees.";try{let t=new s.Q(window.ethereum),a=await t.getSigner(),n=await a.signMessage(e);(await fetch("".concat(p,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:b,signature:n,message:e}),credentials:"include"})).ok?(B(),j(!0),S(!1),D(!1)):(console.error("Bad login"),S(!0),D(!0)),I(!1)}catch(e){console.error("Error during login:",e),S(!0),D(!0),I(!1)}},B=async()=>{console.log("fetching profile...");try{let e=await fetch("".concat(p,"/profile"),{credentials:"include"});if(!e.ok){console.error("Session not active, please log in."),S(!0);return}let t=await e.json();console.log("got profile data ",t," setting secret"),console.log("secret: ",t),j(!0),S(!1)}catch(e){console.error("Error fetching profile:",e),S(!0)}},E=e=>{let t="start.".concat(e),a="".concat(p,"/framer"),n=Date.now();return'\n        <!DOCTYPE html>\n         <html lang="en">\n         <head>\n           <meta charset="UTF-8">\n           <meta name="viewport" content="width=device-width, initial-scale=1.0">\n           <meta property="og:image" content="'.concat(a,"/images/").concat(t,"?").concat(n,'" />\n           <meta property="fc:frame:image" content="').concat(a,"/images/").concat(t,"?").concat(n,'" />\n           <meta property="fc:frame" content="vNext" />\n           <meta property="fc:frame:button:1" content="').concat(h,'" />\n           <meta property="fc:frame:post_url" content="').concat(a,'/start.html" />\n           <title>Image Gallery</title>\n         </head>\n         <body>\n\n             <h1>Image Gallery</h1>\n             <img src="').concat(a,"/images/").concat(t,"?").concat(n,'" alt="start"/>\n             <div>\n               This self-hosted image gallery for Farcaster frames is <a href="https://vaporware.network">vaporware</a>.\n             </div>\n         </body>\n         </html>\n    ')},A=async e=>{let t=e.target.files[0],a=G(t.name),n="start.".concat(a);console.log("Uploading Start Image",t.name,"As ",n),await q(t,"/framer/images",n),console.log("Uploaded Start Image",n);let r=E(a),o=new Blob([r],{type:"text/html"}),c="start.html";console.log("Uploading HTML",c),await q(o,"/framer",c)},T=e=>async(t,n)=>{let r=Array.from(t.target.files);r.length>0&&(await Promise.all(r.map(async t=>{if(t&&t instanceof Blob)try{let n=await y.saveImage(t,t.name,e),r=URL.createObjectURL(t);a(a=>{let o={id:n,name:t.name,previewUrl:r,type:"upload",category:e},c=a.findIndex(e=>"placeholder"===e.type),s=-1!==c?[...a.slice(0,c),o,...a.slice(c)]:[...a,o];return"placeholder"!==s[s.length-1].type&&s.push({id:"placeholder_".concat(Date.now()),type:"placeholder"}),s})}catch(e){console.error("Failed to save ".concat(t.name," to IndexedDB:"),e)}})),t.target.value="")},_=async(e,t,n)=>{try{await y.removeImage(e,t),console.log("Successfully removed image with ID ".concat(e," from IndexedDB.")),a(e=>e.filter((e,t)=>t!==n))}catch(t){console.error("Failed to remove image with ID ".concat(e," from IndexedDB:"),t)}};async function q(e,t,a){let n=await e.arrayBuffer();try{let r=await fetch("".concat(p).concat(t,"/").concat(a),{method:"PUT",headers:{"Content-Type":e.type},credentials:"include",body:n});r.ok?console.log("Upload successful for ".concat(a)):console.error("Error uploading ".concat(a,": "),r.statusText)}catch(e){console.error("Error uploading ".concat(a,": "),e)}}async function L(){l(!1),d(!0),console.log("generateAndUploadAll starting..."),await O(),l(!0),d(!1),console.log("generateAndUploadAll done!")}let O=async()=>{await M("gallery")},M=async e=>{let a=t.filter(e=>"upload"===e.type);for(let e=0;e<a.length;e++){let t=a[e];try{let a=await y.fetchImageById(t.id),n=G(a.name),r="".concat(p,"/framer/images/").concat(e,".").concat(n),o=function(e,t){let a="".concat(p,"/framer"),n=Date.now(),r='\n    <meta property="fc:frame:button:1" content="<-" />\n    <meta property="fc:frame:post_url" content="'.concat(a,"/change/").concat(e,'" />\n    '),o='\n    <meta property="fc:frame:button:2" content="Permalink" />\n    <meta property="fc:frame:button:2:action" content="link" />\n    <meta property="fc:frame:button:2:target" content="'.concat(t,"?").concat(n,'" />\n    '),c='\n    <meta property="fc:frame:button:3" content="->" />\n    <meta property="fc:frame:post_url" content="'.concat(a,"/change/").concat(e,'" />\n    ');return'\n      <!DOCTYPE html>\n      <html lang="en">\n      <head>\n        <title>Image Gallery</title>\n        <meta property="fc:frame" content="vNext" />\n        <meta property="fc:frame:image" content="'.concat(t,"?").concat(n,'" />\n        <meta property="og:image" content="').concat(t,"?").concat(n,'" />\n        ').concat(r,"\n        ").concat(o,"\n        ").concat(c,'\n        <meta property="fc:frame:image:aspect_ratio" content="1:1" />\n      </head>\n      <body>\n        <img src="').concat(t,"?").concat(n,'" alt="Gallery Image" style="aspect-ratio: 1 / 1; width: 100%;" />\n        <!-- Additional content can go here -->\n      </body>\n      </html>\n    ')}("".concat(e,".").concat(n),r),c=new Blob([o],{type:"text/html"}),s="".concat(e,".html");console.log("Uploading HTML",s),await q(c,"/framer",s),console.log("Uploaded HTML",s);let l="".concat(e,".").concat(n);console.log("Uploading Image",l),await q(a.data,"/framer/images",l),console.log("Uploaded Image",l)}catch(e){console.error("Failed to upload image:",e)}}};function G(e){let t=e.lastIndexOf(".");return -1!==t&&0!==t?e.substring(t+1):""}return(0,n.jsx)("div",{className:"container max-w-4xl mx-auto px-4",children:w?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("header",{className:"my-12",children:[(0,n.jsx)("p",{children:(0,n.jsx)("span",{className:"font-bold",children:"How to use this:"})}),(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:["Upload images below. Make sure they conform to the Farcaster Frame requirements.",(0,n.jsxs)("ul",{className:"mb-0",children:[(0,n.jsx)("li",{children:"PNG, JPG, or GIF"}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"1 to 1 square aspect ratio"})," (they will be cropped in the frame otherwise)"]}),(0,n.jsx)("li",{children:"10 MB or less per image"})]})]}),(0,n.jsx)("li",{children:"If you select an incorrect image, refresh the page and start over."}),(0,n.jsx)("li",{children:'Click "Create Frame Link"'}),(0,n.jsx)("li",{children:"Images are first stored locally in your browser, so make sure you upload all here before clicking the Create Frame Link button."})]})]}),(0,n.jsxs)("main",{children:[(0,n.jsxs)("section",{className:"my-12",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Upload the default Frame image."}),(0,n.jsxs)("div",{className:"flex flex-col justify-between items-center md:items-start justify-between",children:[!1,(0,n.jsx)("input",{type:"file",accept:".jpg, .jpeg, .gif, .png",id:"start-image-upload",onChange:A})]})]}),(0,n.jsxs)("section",{className:"my-12",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Choose images"}),(0,n.jsx)("div",{className:"flex flex-col-reverse md:flex-row md:flex-wrap space-y-4 justify-start items-center md:items-start",children:(e="gallery",t.map((t,a)=>"upload"===t.type?(0,n.jsxs)("div",{className:"image-container",children:[(0,n.jsx)("img",{src:t.previewUrl,alt:"Preview ".concat(t.name),className:"upload-image-preview"}),(0,n.jsx)("button",{className:"remove-btn",onClick:()=>_(t.id,e,a),children:"Remove"})]},t.id):(0,n.jsxs)("div",{className:"flex flex-col upload-placeholder",children:[(0,n.jsxs)("label",{htmlFor:"image-upload-".concat(t.id),children:[m?(0,n.jsx)("span",{className:"underline cursor-pointer",children:"+ Add Folder"}):(0,n.jsx)("span",{className:"underline cursor-pointer",children:"+ Add Images"}),m?(0,n.jsx)("input",{type:"file",accept:".jpg, .jpeg, .gif, .png",id:"image-upload-".concat(t.id),style:{display:"none"},onChange:t=>T(e)(t,a),multiple:!0,webkitdirectory:"",directory:""}):(0,n.jsx)("input",{type:"file",accept:".jpg, .jpeg, .gif, .png",id:"image-upload-".concat(t.id),style:{display:"none"},onChange:t=>T(e)(t,a),multiple:!0})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{className:"mt-8",type:"checkbox",checked:m,onChange:e=>g(e.target.checked)}),"Folder select?"]})]},t.id)))})]})]}),(0,n.jsxs)("footer",{className:"mt-24 mb-12 px-4",children:[(0,n.jsx)("div",{className:"flex flex-col md:flex-row md:justify-between items-center md:items-start",children:o?(0,n.jsxs)("div",{className:"shrink flex text-sm max-w-xl flex-col",children:[(0,n.jsx)("div",{className:"mt-8 md:mt-0",children:(0,n.jsx)("span",{className:"break-all",children:"".concat(p,"/framer/start")})}),(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:"mt-4",children:(0,n.jsx)("em",{children:"Copy this link and paste it into a cast to create your Frame."})})})]}):(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"grow",children:[(0,n.jsx)("button",{onClick:L,children:"Create frame link"}),i?(0,n.jsx)("div",{className:"my-2",children:"Creating gallery..."}):(0,n.jsx)(n.Fragment,{})]})})}),(0,n.jsxs)("div",{className:"my-12",children:[(0,n.jsxs)("p",{children:["If you're returning here after initially creating the frame and you don't see your url, here's a reminder:",(0,n.jsx)("br",{}),(0,n.jsx)("span",{className:"break-all",children:"".concat(p,"/framer/start")})]}),(0,n.jsxs)("p",{children:["If you want to change your images, just start over here and they'll be overwritten (but if you add ",(0,n.jsx)("em",{children:"fewer"})," images the second time, the old images at the end of the previous gallery will still be present)."]})]})]})]}):(0,n.jsxs)("div",{className:"mt-32 mx-auto w-full flex-col align-center items-center text-center py-4",children:[(0,n.jsxs)("div",{className:"flex flex-row text-center justify-center align-center items-center",children:[(0,n.jsxs)("div",{className:"mr-2",children:[!b&&(0,n.jsx)("button",{onClick:U,children:"Connect Wallet"}),b&&(0,n.jsx)("button",{onClick:F,children:"Disconnect"})]}),(0,n.jsx)("button",{onClick:P,disabled:!b,children:"Login"})]}),b&&(0,n.jsx)("div",{className:"mt-2 mr-2",children:(0,n.jsxs)("p",{children:["Connected with ",b]})}),N?(0,n.jsx)("p",{className:"mt-2",children:"Logging in..."}):(0,n.jsxs)(n.Fragment,{children:[k&&!C&&(0,n.jsx)("p",{className:"text-red-500 mt-2",children:"You need to log in"}),C&&(0,n.jsx)("p",{className:"text-red-500 mt-2",children:"That didn't work. Are you sure this is your appliance?"})]})]})})}}},function(e){e.O(0,[652,971,69,744],function(){return e(e.s=3279)}),_N_E=e.O()}]);